<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>订单管理 - 无人机自助打卡</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        accent: '#06B6D4',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        'gray-medium': '#64748B',
                        'gray-light': '#E2E8F0',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-light">
    <!-- 页面容器 -->
    <div class="min-h-screen pb-16">
        <!-- 顶部标题区域 -->
        <div class="bg-gradient-to-r from-primary to-accent p-4 text-white">
            <div class="container mx-auto">
                <h1 class="text-xl font-bold">订单管理</h1>
                <p class="text-sm opacity-90">管理和执行客户订单</p>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="container mx-auto px-4 py-4">
            <!-- 今日概览 -->
            <div class="card-tech bg-white p-4 rounded-lg shadow-sm mb-4">
                <h2 class="text-lg font-semibold mb-3">今日概览</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="tech-border p-3 rounded-lg">
                        <div class="text-sm text-gray-medium">今日订单</div>
                        <div class="text-2xl font-bold text-primary mt-1">12</div>
                        <div class="text-xs text-gray-medium mt-1">
                            <i class="fa fa-arrow-up text-success"></i> 较昨日增长 20%
                        </div>
                    </div>
                    <div class="tech-border p-3 rounded-lg">
                        <div class="text-sm text-gray-medium">今日收益</div>
                        <div class="text-2xl font-bold text-accent mt-1">¥1,280</div>
                        <div class="text-xs text-gray-medium mt-1">
                            <i class="fa fa-arrow-up text-success"></i> 较昨日增长 15%
                        </div>
                    </div>
                </div>
            </div>

            <!-- 快捷操作 -->
            <div class="flex gap-4 mb-4">
                <button id="scanOrderBtn" class="flex-1 bg-primary text-white py-3 rounded-lg flex items-center justify-center touch-friendly">
                    <i class="fa fa-qrcode mr-2"></i> 扫码执行订单
                </button>
                <button id="showSamplesBtn" class="flex-1 bg-white text-dark py-3 rounded-lg flex items-center justify-center touch-friendly">
                    <i class="fa fa-image mr-2"></i> 样片预览
                </button>
            </div>

            <!-- 订单列表标签页 -->
            <div class="bg-white rounded-lg shadow-sm mb-4">
                <div class="flex border-b">
                    <button class="order-tab flex-1 py-3 text-center text-primary border-b-2 border-primary font-medium" data-tab="all">
                        全部订单
                    </button>
                    <button class="order-tab flex-1 py-3 text-center text-gray-medium" data-tab="pending">
                        待拍摄
                    </button>
                    <button class="order-tab flex-1 py-3 text-center text-gray-medium" data-tab="processing">
                        进行中
                    </button>
                    <button class="order-tab flex-1 py-3 text-center text-gray-medium" data-tab="completed">
                        已完成
                    </button>
                </div>

                <!-- 订单搜索 -->
                <div class="p-3 border-b">
                    <div class="relative">
                        <input type="text" placeholder="搜索订单号或客户名称" class="w-full py-2 px-10 bg-gray-light/50 rounded-full text-sm">
                        <i class="fa fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-medium"></i>
                    </div>
                </div>

                <!-- 订单列表 -->
                <div class="order-list-container">
                    <!-- 全部订单列表 -->
                    <div id="all-orders" class="order-list">
                        <!-- 订单项 -->
                        <div class="order-item p-3 border-b">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="font-medium">订单号: DX20230615001</span>
                                        <span class="status-tag status-pending ml-2">待拍摄</span>
                                    </div>
                                    <div class="text-sm text-gray-medium mt-1">客户: 张先生 (138****1234)</div>
                                    <div class="text-sm text-gray-medium mt-1">
                                        <i class="fa fa-map-marker"></i> 福州鼓山景区 - 涌泉寺
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium text-primary">¥128</div>
                                    <div class="text-xs text-gray-medium">今天 10:30</div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button class="flex-1 bg-primary text-white py-2 rounded text-sm touch-friendly" onclick="startOrder('DX20230615001')">
                                    一键启动
                                </button>
                                <button class="flex-1 bg-white border border-gray-light text-dark py-2 rounded text-sm touch-friendly" onclick="makePhoneCall('13812341234')">
                                    <i class="fa fa-phone"></i> 联系客户
                                </button>
                            </div>
                        </div>

                        <!-- 订单项 -->
                        <div class="order-item p-3 border-b">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="font-medium">订单号: DX20230615002</span>
                                        <span class="status-tag status-processing ml-2">拍摄中</span>
                                    </div>
                                    <div class="text-sm text-gray-medium mt-1">客户: 李女士 (139****5678)</div>
                                    <div class="text-sm text-gray-medium mt-1">
                                        <i class="fa fa-map-marker"></i> 福州鼓山景区 - 摩崖石刻
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium text-primary">¥198</div>
                                    <div class="text-xs text-gray-medium">今天 11:15</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-xs text-gray-medium mb-1">拍摄进度: 2/5</div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 40%"></div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button class="flex-1 bg-primary text-white py-2 rounded text-sm touch-friendly" onclick="continueOrder('DX20230615002')">
                                    继续拍摄
                                </button>
                                <button class="flex-1 bg-white border border-gray-light text-dark py-2 rounded text-sm touch-friendly" onclick="cancelOrder('DX20230615002')">
                                    取消订单
                                </button>
                            </div>
                        </div>

                        <!-- 订单项 -->
                        <div class="order-item p-3 border-b">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="font-medium">订单号: DX20230615003</span>
                                        <span class="status-tag status-completed ml-2">已完成</span>
                                    </div>
                                    <div class="text-sm text-gray-medium mt-1">客户: 王先生 (135****9012)</div>
                                    <div class="text-sm text-gray-medium mt-1">
                                        <i class="fa fa-map-marker"></i> 福州鼓山景区 - 登山古径
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium text-primary">¥258</div>
                                    <div class="text-xs text-gray-medium">今天 09:20</div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button class="flex-1 bg-white border border-primary text-primary py-2 rounded text-sm touch-friendly">
                                    查看成片
                                </button>
                                <button class="flex-1 bg-white border border-accent text-accent py-2 rounded text-sm touch-friendly">
                                    增值服务
                                </button>
                            </div>
                        </div>

                        <!-- 订单项 -->
                        <div class="order-item p-3">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="font-medium">订单号: DX20230615004</span>
                                        <span class="status-tag status-cancelled ml-2">已取消</span>
                                    </div>
                                    <div class="text-sm text-gray-medium mt-1">客户: 赵女士 (136****3456)</div>
                                    <div class="text-sm text-gray-medium mt-1">
                                        <i class="fa fa-map-marker"></i> 福州鼓山景区 - 屴崱峰
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium text-gray-medium">¥128</div>
                                    <div class="text-xs text-gray-medium">今天 08:45</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-xs text-gray-medium">取消原因: 客户临时有事</div>
                            </div>
                        </div>
                    </div>

                    <!-- 待拍摄订单列表 -->
                    <div id="pending-orders" class="order-list hidden">
                        <!-- 待拍摄订单内容 -->
                    </div>

                    <!-- 进行中订单列表 -->
                    <div id="processing-orders" class="order-list hidden">
                        <!-- 进行中订单内容 -->
                    </div>

                    <!-- 已完成订单列表 -->
                    <div id="completed-orders" class="order-list hidden">
                        <!-- 已完成订单内容 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 样片预览模态框 -->
        <div id="samplesModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center">
            <div class="bg-white w-full max-w-md rounded-lg m-4">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 class="font-semibold">样片预览</h3>
                    <button id="closeSamplesBtn" class="text-gray-medium">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="p-4 max-h-[70vh] overflow-y-auto">
                    <div class="grid grid-cols-2 gap-3">
                        <!-- 样片项 -->
                        <div class="sample-item">
                            <div class="relative">
                                <img src="https://picsum.photos/id/1018/300/200" alt="涌泉寺" class="w-full h-32 object-cover rounded-lg">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                                    <div class="text-white text-sm font-medium">涌泉寺</div>
                                </div>
                                <div class="absolute top-2 right-2">
                                    <input type="checkbox" class="sample-checkbox w-5 h-5">
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <div class="text-xs text-gray-medium">¥98 / 次</div>
                            </div>
                        </div>
                        
                        <!-- 样片项 -->
                        <div class="sample-item">
                            <div class="relative">
                                <img src="https://picsum.photos/id/1019/300/200" alt="摩崖石刻" class="w-full h-32 object-cover rounded-lg">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                                    <div class="text-white text-sm font-medium">摩崖石刻</div>
                                </div>
                                <div class="absolute top-2 right-2">
                                    <input type="checkbox" class="sample-checkbox w-5 h-5">
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <div class="text-xs text-gray-medium">¥98 / 次</div>
                            </div>
                        </div>
                        
                        <!-- 样片项 -->
                        <div class="sample-item">
                            <div class="relative">
                                <img src="https://picsum.photos/id/1035/300/200" alt="登山古径" class="w-full h-32 object-cover rounded-lg">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                                    <div class="text-white text-sm font-medium">登山古径</div>
                                </div>
                                <div class="absolute top-2 right-2">
                                    <input type="checkbox" class="sample-checkbox w-5 h-5">
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <div class="text-xs text-gray-medium">¥128 / 次</div>
                            </div>
                        </div>
                        
                        <!-- 样片项 -->
                        <div class="sample-item">
                            <div class="relative">
                                <img src="https://picsum.photos/id/1036/300/200" alt="屴崱峰" class="w-full h-32 object-cover rounded-lg">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                                    <div class="text-white text-sm font-medium">屴崱峰</div>
                                </div>
                                <div class="absolute top-2 right-2">
                                    <input type="checkbox" class="sample-checkbox w-5 h-5">
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <div class="text-xs text-gray-medium">¥128 / 次</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h4 class="font-medium mb-2">客户信息</h4>
                        <div class="space-y-3">
                            <div class="form-group">
                                <input type="text" placeholder="客户姓名" class="form-control">
                            </div>
                            <div class="form-group">
                                <input type="tel" placeholder="客户电话" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm">已选择: <span id="selectedCount">0</span> 个样片</div>
                        <div class="font-medium">总价: <span class="text-primary" id="totalPrice">¥0</span></div>
                    </div>
                    <button id="generateOrderBtn" class="btn btn-tech w-full">生成订单</button>
                </div>
            </div>
        </div>

        <!-- 底部导航栏 -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-light z-40 safe-area-bottom">
            <div class="flex h-14">
                <a href="order.html" class="nav-item active" data-page="order">
                    <i class="fa fa-list-alt text-lg mb-1"></i>
                    <span class="text-xs">订单</span>
                </a>
                <a href="device.html" class="nav-item" data-page="device">
                    <i class="fa fa-paper-plane text-lg mb-1"></i>
                    <span class="text-xs">设备</span>
                </a>
                <a href="report.html" class="nav-item" data-page="report">
                    <i class="fa fa-bar-chart text-lg mb-1"></i>
                    <span class="text-xs">报表</span>
                </a>
                <a href="profile.html" class="nav-item" data-page="profile">
                    <i class="fa fa-user text-lg mb-1"></i>
                    <span class="text-xs">我的</span>
                </a>
            </div>
        </nav>

        <!-- 扫码悬浮按钮 -->
        <div class="fixed right-4 bottom-20 z-30">
            <button id="floatingScanBtn" class="scan-btn shadow-lg touch-friendly">
                <i class="fa fa-qrcode"></i>
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 订单标签页切换
            const orderTabs = document.querySelectorAll('.order-tab');
            const orderLists = document.querySelectorAll('.order-list');
            
            orderTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 更新标签页样式
                    orderTabs.forEach(t => {
                        t.classList.remove('text-primary', 'border-b-2', 'border-primary');
                        t.classList.add('text-gray-medium');
                    });
                    this.classList.remove('text-gray-medium');
                    this.classList.add('text-primary', 'border-b-2', 'border-primary');
                    
                    // 显示对应的订单列表
                    orderLists.forEach(list => {
                        list.classList.add('hidden');
                    });
                    document.getElementById(`${tabId}-orders`).classList.remove('hidden');
                });
            });
            
            // 扫码按钮
            const scanOrderBtn = document.getElementById('scanOrderBtn');
            const floatingScanBtn = document.getElementById('floatingScanBtn');
            
            [scanOrderBtn, floatingScanBtn].forEach(btn => {
                btn.addEventListener('click', function() {
                    scanQRCode(function(result) {
                        // 处理扫码结果
                        showToast(`已扫描订单: ${result}`);
                        // 这里应该根据扫码结果跳转到相应的订单详情或执行页面
                        setTimeout(() => {
                            window.location.href = 'order-shooting.html?order=' + result;
                        }, 1000);
                    });
                });
            });
            
            // 样片预览模态框
            const showSamplesBtn = document.getElementById('showSamplesBtn');
            const samplesModal = document.getElementById('samplesModal');
            const closeSamplesBtn = document.getElementById('closeSamplesBtn');
            const generateOrderBtn = document.getElementById('generateOrderBtn');
            
            showSamplesBtn.addEventListener('click', function() {
                samplesModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
            
            closeSamplesBtn.addEventListener('click', function() {
                samplesModal.classList.add('hidden');
                document.body.style.overflow = '';
            });
            
            // 样片选择逻辑
            const sampleCheckboxes = document.querySelectorAll('.sample-checkbox');
            const selectedCountEl = document.getElementById('selectedCount');
            const totalPriceEl = document.getElementById('totalPrice');
            let selectedCount = 0;
            let totalPrice = 0;
            
            sampleCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const priceText = this.closest('.sample-item').querySelector('.text-gray-medium').textContent;
                    const price = parseInt(priceText.match(/\d+/)[0]);
                    
                    if (this.checked) {
                        selectedCount++;
                        totalPrice += price;
                    } else {
                        selectedCount--;
                        totalPrice -= price;
                    }
                    
                    selectedCountEl.textContent = selectedCount;
                    totalPriceEl.textContent = `¥${totalPrice}`;
                });
            });
            
            // 生成订单按钮
            generateOrderBtn.addEventListener('click', function() {
                if (selectedCount === 0) {
                    showToast('请至少选择一个样片', 'error');
                    return;
                }
                
                showToast('订单生成成功');
                samplesModal.classList.add('hidden');
                document.body.style.overflow = '';
                
                // 这里应该跳转到支付页面或显示支付二维码
            });
        });
        
        // 启动订单
        function startOrder(orderId) {
            showConfirm('启动订单', `确定要启动订单 ${orderId} 的拍摄吗？`, function() {
                window.location.href = `order-shooting.html?order=${orderId}`;
            });
        }
        
        // 继续拍摄
        function continueOrder(orderId) {
            window.location.href = `order-shooting.html?order=${orderId}`;
        }
        
        // 取消订单
        function cancelOrder(orderId) {
            showConfirm('取消订单', `确定要取消订单 ${orderId} 吗？取消后将无法恢复。`, function() {
                showLoading();
                
                // 模拟API请求
                setTimeout(() => {
                    hideLoading();
                    showToast('订单已取消');
                    
                    // 更新UI，这里简单处理为刷新页面
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }, 1000);
            });
        }
    </script>
</body>
</html> 